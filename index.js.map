{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./index.ts","webpack:///./src/Controller.ts","webpack:///./src/ControllerConfig.ts","webpack:///external \"express-csv\""],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;AAGA;AACA;;;;;;;;;;;;;;;;;;;;;ACzE6C;AACU;;;;;;;;;;;;;;;;;ACCF;AAErD,mBAAO,CAAC,gCAAa,CAAC;AAEtB,IAAM,SAAS,GAAG,UAAC,CAAM;IACvB,MAAM,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,QAAQ,CAAC,CAAC,CAAC;AAC7C,CAAC;AAyDD,IAAM,aAAa,GAAG,GAAG;AACzB,IAAM,sBAAsB,GAAG,GAAG;AAClC,IAAM,qBAAqB,GAAG,GAAG;AACjC,IAAM,YAAY,GAAG,GAAG;AAExB;;;;GAIG;AACH;IAOE;;;;;OAKG;IACH,oBAAY,MAAqB;QATvB,gBAAW,GAAG,YAAY;QAC1B,gBAAW,GAAG,sBAAsB;QAS5C,MAAM,GAAG,MAAM,IAAI,EAAE;QACrB,IAAI,CAAC,mBAAmB,GAAG,MAAM,CAAC,WAAW,IAAI,EAAE;QACnD,IAAI,CAAC,mBAAmB,GAAG,MAAM,CAAC,WAAW,IAAI,EAAE;QACnD,IAAI,CAAC,kBAAkB,GAAG,MAAM,CAAC,UAAU,IAAI,EAAE;QACjD,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,MAAM,IAAI,YAAY;QAChD,IAAI,CAAC,WAAW,GAAG,MAAM,CAAC,QAAQ,IAAI,sBAAsB;IAC9D,CAAC;IACD;;;;;;;OAOG;IACW,sBAAW,GAAzB,UAA0B,GAAY,EAAE,GAAa,EAAE,KAAa;QAClE,MAAM,CAAC,UAAC,MAAoB;YAC1B,IAAI,IAAI,GAAG,sBAAsB;YACjC,IAAI,IAAI;YACR,EAAE,CAAC,CAAC,MAAM,CAAC,IAAI,IAAI,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,GAAG,aAAa,CAAC,CAAC,CAAC;gBACzE,IAAI,GAAG,MAAM,CAAC,IAAI;YACpB,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,IAAI,GAAG,cAAc,GAAG,MAAM,CAAC,IAAI;YACrC,CAAC;YAED,IAAM,QAAQ,GAAG,UAAU,CAAC,gBAAgB,CAC1C,GAAG,EACH,KAAK,EACL,IAAI,EACJ,KAAK,EACL,SAAS,EACT,MAAM,CAAC,KAAK,IAAI,MAAM,EACtB,MAAM,CAAC,KAAK,EACZ,IAAI,EACJ,MAAM,CAAC,OAAO,CACf;YAED,EAAE,CAAC,CACD,CAAC,IAAI,KAAK,sBAAsB,IAAI,OAAO,CAAC,GAAG,CAAC,qBAAqB,KAAK,MAAM,CAAC;gBACjF,OAAO,CAAC,GAAG,CAAC,qBAAqB,KAAK,MACxC,CAAC,CAAC,CAAC;gBACD,OAAO,CAAC,GAAG,CAAC,IAAI,GAAG,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;gBAElE,EAAE,CAAC,CAAC,QAAQ,CAAC,KAAK,KAAK,SAAS,CAAC,CAAC,CAAC;oBACjC,OAAO,CAAC,GAAG,CAAC,SAAS,GAAG,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;gBAC/D,CAAC;gBAED,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,KAAK,SAAS,IAAI,MAAM,CAAC,KAAK,CAAC,WAAW,KAAK,KAAK,CAAC,CAAC,CAAC;oBACrE,IAAM,KAAK,GAAG,MAAM,CAAC,KAAc;oBACnC,EAAE,CAAC,CAAC,KAAK,CAAC,KAAK,KAAK,SAAS,CAAC,CAAC,CAAC;wBAC9B,OAAO,CAAC,GAAG,CAAC,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;oBAC5D,CAAC;gBACH,CAAC;YACH,CAAC;YAED,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC;QACjC,CAAC;IACH,CAAC;IAED;;;;;;;OAOG;IACW,qBAAU,GAAxB,UAAyB,GAAY,EAAE,GAAa,EAAE,KAAa;QACjE,MAAM,CAAC,UAAC,MAAiB;YACvB;;;;;;eAMG;YAEH,GAAG;iBACA,MAAM,CAAC,MAAM,CAAC,IAAI,IAAI,YAAY,CAAC;iBACnC,IAAI,CACH,UAAU,CAAC,gBAAgB,CAAC,GAAG,EAAE,KAAK,EAAE,MAAM,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,IAAI,EAAE,SAAS,EAAE,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,CAC/G;QACL,CAAC;IACH,CAAC;IAEc,2BAAgB,GAA/B,UACE,GAAY,EACZ,UAAkB,EAClB,IAAY,EACZ,OAAgB,EAChB,IAAa,EACb,KAAW,EACX,KAAc,EACd,IAAU,EACV,OAAgB;QAEhB,IAAM,aAAa,GAAG,OAAO,CAAC,GAAG,CAAC,sBAAsB,IAAI,SAAS;QACrE,IAAM,QAAQ,GAAsB;YAClC,IAAI;YACJ,OAAO;YACP,IAAI,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;YAC9B,MAAM,EAAE;gBACN,IAAI,EAAE,kEAAgB,CAAC,aAAa,CAAC,WAAW;gBAChD,WAAW,EAAE,kEAAgB,CAAC,aAAa,CAAC,kBAAkB;gBAC9D,GAAG,EAAE,aAAa;gBAClB,OAAO,EAAE,kEAAgB,CAAC,aAAa,CAAC,cAAc;aACvD;YACD,OAAO,EAAE;gBACP,GAAG,EAAE,GAAG,CAAC,WAAW;gBACpB,MAAM,EAAE,GAAG,CAAC,MAAM;gBAClB,KAAK,EAAE,UAAU;aAClB;SACF;QACD,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACT,QAAQ,CAAC,IAAI,GAAG,IAAI;QACtB,CAAC;QACD,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;YACV,EAAE,CAAC,CAAC,KAAK,CAAC,WAAW,KAAK,KAAK,CAAC,CAAC,CAAC;gBAChC,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC,OAAO;gBAC9B,QAAQ,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK;YAC9B,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,QAAQ,CAAC,KAAK,GAAG,KAAK;gBACtB,QAAQ,CAAC,KAAK,GAAG,KAAK;YACxB,CAAC;QACH,CAAC;QACD,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACT,QAAQ,CAAC,IAAI,GAAG,IAAI;QACtB,CAAC;QACD,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACZ,QAAQ,CAAC,OAAO,GAAG,OAAO;QAC5B,CAAC;QACD,MAAM,CAAC,QAAQ;IACjB,CAAC;IAEM,4BAAO,GAAd;QAAA,iBAyCC;QAxCC,MAAM,CAAC,UAAC,GAAY,EAAE,GAAa;YACjC,KAAI,CAAC,WAAW,CAAC,GAAG,CAAC;iBAClB,IAAI,CAAC,oBAAU;gBACd,MAAM,CAAC,KAAI,CAAC,aAAa,CAAC,UAAU,EAAE,GAAG,EAAE,GAAG,CAAC;YACjD,CAAC,CAAC;iBACD,IAAI,CAAC,gBAAM;gBACV,EAAE,CAAC,CAAC,MAAM,CAAC,WAAW,KAAK,KAAK,CAAC,CAAC,CAAC;oBACjC,UAAU,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;wBACtD,IAAI,EAAE,GAAG;wBACT,KAAK,EAAE,sCAAsC,GAAG,MAAM,CAAC,WAAW,CAAC,IAAI;qBACxE,CAAC;gBACJ,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACN,CAAC;oBAAC,GAAW,CAAC,GAAG,CAAC,MAAM,CAAC;gBAC3B,CAAC;gBAED,wEAAwE;gBACxE,uBAAuB;gBACvB,gCAAgC;gBAChC,KAAK;gBACL,EAAE;gBACF,uCAAuC;gBACvC,eAAe;gBACf,yFAAyF;gBACzF,aAAa;gBACb,sDAAsD;gBACtD,oBAAoB;gBACpB,MAAM;gBACN,KAAK;YACP,CAAC,CAAC;iBACD,KAAK,CAAC,UAAC,YAAiB;gBACvB,YAAY,GAAG,YAAY,IAAI,EAAE;gBACjC,IAAM,IAAI,GAAG,YAAY,CAAC,IAAI,IAAI,KAAI,CAAC,WAAW;gBAClD,IAAM,KAAK,GAAG,YAAY,CAAC,KAAK,IAAI,YAAY,CAAC,QAAQ,IAAI,YAAY,CAAC,OAAO,IAAI,YAAY;gBACjG,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,IAAI,GAAG,mBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;gBACjF,EAAE,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;oBACvB,OAAO,CAAC,GAAG,CAAC,SAAS,GAAG,YAAY,CAAC,KAAK,CAAC;gBAC7C,CAAC;gBACD,UAAU,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,QAAE,KAAK,SAAE,KAAK,EAAE,YAAY,CAAC,KAAK,EAAE,CAAC;YACrG,CAAC,CAAC;QACN,CAAC;IACH,CAAC;IAEM,4BAAO,GAAd;QAAA,iBA4BC;QA3BC,MAAM,CAAC,UAAC,GAAY,EAAE,GAAa;YACjC,KAAI,CAAC,WAAW,CAAC,GAAG,CAAC;iBAClB,IAAI,CAAC,oBAAU;gBACd,MAAM,CAAC,KAAI,CAAC,aAAa,CAAC,UAAU,EAAE,GAAG,EAAE,GAAG,CAAC;YACjD,CAAC,CAAC;iBACD,IAAI,CAAC,uBAAa;gBACjB,aAAa,GAAG,aAAa,IAAI,EAAE;gBACnC,IAAM,OAAO,GACX,aAAa,CAAC,IAAI,KAAK,SAAS;sBAC5B,aAAa;sBACb;wBACE,IAAI,EAAE,KAAI,CAAC,WAAW;wBACtB,IAAI,EAAE,aAAa;qBACpB;gBACP,UAAU,CAAC,UAAU,CAAC,GAAG,EAAE,GAAG,EAAE,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC;YACjE,CAAC,CAAC;iBACD,KAAK,CAAC,UAAC,YAAiB;gBACvB,YAAY,GAAG,YAAY,IAAI,EAAE;gBACjC,IAAM,IAAI,GAAG,YAAY,CAAC,IAAI,IAAI,KAAI,CAAC,WAAW;gBAClD,IAAM,KAAK,GAAG,YAAY,CAAC,KAAK,IAAI,YAAY,CAAC,QAAQ,IAAI,YAAY,CAAC,OAAO,IAAI,YAAY;gBACjG,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,IAAI,GAAG,mBAAmB,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC;gBACjF,EAAE,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;oBACvB,OAAO,CAAC,GAAG,CAAC,SAAS,GAAG,YAAY,CAAC,KAAK,CAAC;gBAC7C,CAAC;gBACD,UAAU,CAAC,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,QAAE,KAAK,SAAE,KAAK,EAAE,YAAY,CAAC,KAAK,EAAE,CAAC;YACrG,CAAC,CAAC;QACN,CAAC;IACH,CAAC;IAIO,gCAAW,GAAnB,UAAoB,GAAY;QAC9B,IAAM,UAAU,GAAkB,EAAE;QACpC,GAAG,CAAC,CAAC,IAAI,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAAG,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,QAAQ,EAAE,EAAE,CAAC;YAC9E,IAAM,aAAa,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC;YACxD,IAAM,UAAU,GAAQ,GAAG,CAAC,KAAK,CAAC,aAAa,CAAC;YAChD,EAAE,CAAC,CAAC,UAAU,KAAK,SAAS,CAAC,CAAC,CAAC;gBAC7B,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC;oBACpB,IAAI,EAAE,qBAAqB;oBAC3B,KAAK,EAAE,qDAAqD,GAAG,aAAa;iBAC7E,CAAC;YACJ,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,UAAU,CAAC,aAAa,CAAC,GAAG,UAAU;YACxC,CAAC;QACH,CAAC;QACD,GAAG,CAAC,CAAC,IAAI,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAAG,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,QAAQ,EAAE,EAAE,CAAC;YAC9E,IAAM,aAAa,GAAG,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC;YACxD,IAAM,UAAU,GAAG,GAAG,CAAC,MAAM,CAAC,aAAa,CAAC;YAC5C,EAAE,CAAC,CAAC,UAAU,KAAK,SAAS,CAAC,CAAC,CAAC;gBAC7B,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC;oBACpB,IAAI,EAAE,sBAAsB;oBAC5B,KAAK,EAAE,mDAAmD,GAAG,aAAa;iBAC3E,CAAC;YACJ,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,UAAU,CAAC,aAAa,CAAC,GAAG,UAAU;YACxC,CAAC;QACH,CAAC;QACD,GAAG,CAAC,CAAC,IAAI,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,QAAQ,EAAE,EAAE,CAAC;YAC7E,IAAM,aAAa,GAAG,IAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC;YACvD,IAAM,UAAU,GAAG,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC;YAC1C,EAAE,CAAC,CAAC,UAAU,KAAK,SAAS,CAAC,CAAC,CAAC;gBAC7B,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC;oBACpB,IAAI,EAAE,sBAAsB;oBAC5B,KAAK,EAAE,qDAAqD,GAAG,aAAa;iBAC7E,CAAC;YACJ,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,UAAU,CAAC,aAAa,CAAC,GAAG,UAAU;YACxC,CAAC;QACH,CAAC;QAED,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC;IACpC,CAAC;IACH,iBAAC;AAAD,CAAC;;;;;;;;;;;;;;;;;ACnVD;IAAA;IAMA,CAAC;IALe,8BAAa,GAAG;QAC5B,WAAW,EAAE,sBAAsB;QACnC,kBAAkB,EAAE,6BAA6B;QACjD,cAAc,EAAE,yBAAyB;KAC1C;IACH,uBAAC;CAAA;AAN4B;;;;;;;;;;;;;;;;;;;;;;;;ACA7B,wC","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading wasm modules\n \tvar installedWasmModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// object with all compiled WebAssembly.Modules\n \t__webpack_require__.w = {};\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export { Controller } from './src/Controller'\nexport {ControllerConfig} from './src/ControllerConfig'\n","import * as Bluebird from 'bluebird'\nimport { Request, Response } from 'express'\nimport { ControllerConfig } from './ControllerConfig'\n\nrequire('express-csv')\n\nconst isNumeric = (n: any) => {\n  return !isNaN(parseFloat(n)) && isFinite(n)\n}\n\nexport interface IServerDetails {\n  name: string\n  description: string\n  env: string\n  version: string\n}\n\nexport interface IRequestDetails {\n  url: string\n  method: string\n  route: string\n}\n\n// export interface IResponse extends Response {\n//   unusedKey?: string\n// }\n\nexport interface IResponseEnvelope {\n  code: number\n  success: boolean\n  server: IServerDetails\n  request: IRequestDetails\n  time: string\n  data?: object\n  error?: string\n  stack?: string\n  meta?: any\n  message?: string\n}\n\nexport interface IErrorParams {\n  code: number\n  error?: string | object | Error\n  stack?: string\n  message?: string\n}\n\nexport interface IOkParams {\n  code: number\n  data?: object\n  message?: string\n}\n\nexport interface IRouteConfig {\n  queryParams?: Array<string>\n  routeParams?: Array<string>\n  bodyParams?: Array<string>\n  okCode?: number\n  failCode?: number\n}\n\nexport interface IParamsObject {\n  [key: string]: any\n}\n\nconst HTTP_CODE_MAX = 600\nconst HTTP_CODE_SERVER_ERROR = 500\nconst HTTP_CODE_INPUT_ERROR = 400\nconst HTTP_CODE_OK = 200\n\n/**\n * Constructor\n *\n * @class BaseRoute\n */\nexport abstract class Controller {\n  protected requiredQueryParams: Array<string>\n  protected requiredRouteParams: Array<string>\n  protected requiredBodyParams: Array<string>\n  protected successCode = HTTP_CODE_OK\n  protected failureCode = HTTP_CODE_SERVER_ERROR\n\n  /**\n   * Constructor\n   *\n   * @class BaseRoute\n   * @constructor\n   */\n  constructor(config?: IRouteConfig) {\n    config = config || {}\n    this.requiredQueryParams = config.queryParams || []\n    this.requiredRouteParams = config.routeParams || []\n    this.requiredBodyParams = config.bodyParams || []\n    this.successCode = config.okCode || HTTP_CODE_OK\n    this.failureCode = config.failCode || HTTP_CODE_SERVER_ERROR\n  }\n  /**\n   * errResponse\n   *\n   * @param req\n   * @param res\n   * @param title\n   * @returns {(params:any)=>undefined}\n   */\n  public static errResponse(req: Request, res: Response, title: string) {\n    return (params: IErrorParams) => {\n      let code = HTTP_CODE_SERVER_ERROR\n      let meta\n      if (params.code && isNumeric(params.code) && params.code < HTTP_CODE_MAX) {\n        code = params.code\n      } else {\n        meta = 'Error code: ' + params.code\n      }\n\n      const response = Controller.responseEnvelope(\n        req,\n        title,\n        code,\n        false,\n        undefined,\n        params.error || params,\n        params.stack,\n        meta,\n        params.message\n      )\n\n      if (\n        (code === HTTP_CODE_SERVER_ERROR && process.env.INSTRUMENT_ERRORS_500 === 'true') ||\n        process.env.INSTRUMENT_ERRORS_ALL === 'true'\n      ) {\n        console.log(code + ' error: ' + JSON.stringify(response, null, 2))\n\n        if (response.stack !== undefined) {\n          console.log('Stack: ' + response.stack.replace(/\\\\n/g, '\\n'))\n        }\n\n        if (params.error !== undefined && params.error.constructor === Error) {\n          const error = params.error as Error\n          if (error.stack !== undefined) {\n            console.log('Stack: ' + error.stack.replace(/\\\\n/g, '\\n'))\n          }\n        }\n      }\n\n      res.status(code).json(response)\n    }\n  }\n\n  /**\n   * okResponse\n   *\n   * @param req\n   * @param res\n   * @param title\n   * @returns {(params:any)=>undefined}\n   */\n  public static okResponse(req: Request, res: Response, title: string) {\n    return (params: IOkParams) => {\n      /*\n       if (params.code !== undefined && params.data !== undefined){\n       res.success(responseEnvelope(req,params.code,1,params.data,null));\n       } else {\n       res.success(responseEnvelope(req,200,1,params,null));\n       }\n       */\n\n      res\n        .status(params.code || HTTP_CODE_OK)\n        .json(\n          Controller.responseEnvelope(req, title, params.code, true, params.data, null, undefined, null, params.message)\n        )\n    }\n  }\n\n  private static responseEnvelope(\n    req: Request,\n    routeTitle: string,\n    code: number,\n    success: boolean,\n    data?: object,\n    error?: any,\n    stack?: string,\n    meta?: any,\n    message?: string\n  ) {\n    const envDescriptor = process.env.ENVIRONMENT_DESCRIPTOR || 'unknown'\n    const response: IResponseEnvelope = {\n      code,\n      success,\n      time: new Date().toISOString(),\n      server: {\n        name: ControllerConfig.packageConfig.packageName,\n        description: ControllerConfig.packageConfig.packageDescription,\n        env: envDescriptor,\n        version: ControllerConfig.packageConfig.packageVersion,\n      },\n      request: {\n        url: req.originalUrl,\n        method: req.method,\n        route: routeTitle,\n      },\n    }\n    if (data) {\n      response.data = data\n    }\n    if (error) {\n      if (error.constructor === Error) {\n        response.error = error.message\n        response.stack = error.stack\n      } else {\n        response.error = error\n        response.stack = stack\n      }\n    }\n    if (meta) {\n      response.meta = meta\n    }\n    if (message) {\n      response.message = message\n    }\n    return response\n  }\n\n  public csvFile() {\n    return (req: Request, res: Response) => {\n      this.parseParams(req)\n        .then(parameters => {\n          return this.handleRequest(parameters, req, res)\n        })\n        .then(result => {\n          if (result.constructor !== Array) {\n            Controller.errResponse(req, res, this.constructor.name)({\n              code: 500,\n              error: 'CSV route emitted non-array result: ' + result.constructor.name,\n            })\n          } else {\n            ;(res as any).csv(result)\n          }\n\n          // res.setHeader('Content-disposition', 'attachment; filename=data.csv')\n          // res.writeHead(200, {\n          //   'Content-Type': 'text/csv',\n          // })\n          //\n          // csvStringify(result, (csv, err) => {\n          //   if (err) {\n          //     Controller.errResponse(req, res, this.constructor.name)({ code: 500, error: err })\n          //   } else {\n          //     console.log('Sending csv to response: ' + csv);\n          //     res.send(csv)\n          //   }\n          // })\n        })\n        .catch((handlerError: any) => {\n          handlerError = handlerError || {}\n          const code = handlerError.code || this.failureCode\n          const error = handlerError.error || handlerError.response || handlerError.message || handlerError\n          console.log('Error ' + code + ' during request: ' + JSON.stringify(error) + ', ')\n          if (handlerError.stack) {\n            console.log('stack: ' + handlerError.stack)\n          }\n          Controller.errResponse(req, res, this.constructor.name)({ code, error, stack: handlerError.stack })\n        })\n    }\n  }\n\n  public jsonAPI() {\n    return (req: Request, res: Response) => {\n      this.parseParams(req)\n        .then(parameters => {\n          return this.handleRequest(parameters, req, res)\n        })\n        .then(handlerResult => {\n          handlerResult = handlerResult || {}\n          const payload =\n            handlerResult.code !== undefined\n              ? handlerResult\n              : {\n                  code: this.successCode,\n                  data: handlerResult,\n                }\n          Controller.okResponse(req, res, this.constructor.name)(payload)\n        })\n        .catch((handlerError: any) => {\n          handlerError = handlerError || {}\n          const code = handlerError.code || this.failureCode\n          const error = handlerError.error || handlerError.response || handlerError.message || handlerError\n          console.log('Error ' + code + ' during request: ' + JSON.stringify(error) + ', ')\n          if (handlerError.stack) {\n            console.log('stack: ' + handlerError.stack)\n          }\n          Controller.errResponse(req, res, this.constructor.name)({ code, error, stack: handlerError.stack })\n        })\n    }\n  }\n\n  protected abstract handleRequest(params: any, req: Request, res: Response): Promise<any> | Bluebird<any>\n\n  private parseParams(req: Request): Promise<IParamsObject> {\n    const parameters: IParamsObject = {}\n    for (let paramIdx = 0; paramIdx < this.requiredQueryParams.length; paramIdx++) {\n      const requiredParam = this.requiredQueryParams[paramIdx]\n      const foundParam: any = req.query[requiredParam]\n      if (foundParam === undefined) {\n        return Promise.reject({\n          code: HTTP_CODE_INPUT_ERROR,\n          error: 'Required query parameter not found in request url: ' + requiredParam,\n        })\n      } else {\n        parameters[requiredParam] = foundParam\n      }\n    }\n    for (let paramIdx = 0; paramIdx < this.requiredRouteParams.length; paramIdx++) {\n      const requiredParam = this.requiredRouteParams[paramIdx]\n      const foundParam = req.params[requiredParam]\n      if (foundParam === undefined) {\n        return Promise.reject({\n          code: HTTP_CODE_SERVER_ERROR,\n          error: 'Required route parameter not mapped for request: ' + requiredParam,\n        })\n      } else {\n        parameters[requiredParam] = foundParam\n      }\n    }\n    for (let paramIdx = 0; paramIdx < this.requiredBodyParams.length; paramIdx++) {\n      const requiredParam = this.requiredBodyParams[paramIdx]\n      const foundParam = req.body[requiredParam]\n      if (foundParam === undefined) {\n        return Promise.reject({\n          code: HTTP_CODE_SERVER_ERROR,\n          error: 'Required body parameter not included with request: ' + requiredParam,\n        })\n      } else {\n        parameters[requiredParam] = foundParam\n      }\n    }\n\n    return Promise.resolve(parameters)\n  }\n}\n","export class ControllerConfig {\n  public static packageConfig = {\n    packageName: 'Default Package Name',\n    packageDescription: 'Default Package Description',\n    packageVersion: 'Default Package Version',\n  }\n}\n","module.exports = require(\"express-csv\");"],"sourceRoot":""}